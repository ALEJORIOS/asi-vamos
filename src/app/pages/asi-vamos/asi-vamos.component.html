<top-bar [date]="currentDate"></top-bar>
<div class="layout">
    <div *ngIf="!rotateTable" class="card main">
        <div class="summaryChart">
            <canvas #summaryPriceChart></canvas>
        </div>
        <div class="info">
            <div class="title">
                <div class="icon icon-money">
                    <i class="fa-duotone fa-cart-shopping" style="--fa-primary-color: #ffffff; --fa-secondary-color: #ffffff;"></i>
                </div>
                <h3>Ventas en $MM</h3>
            </div>
            <div class="data">
                <div class="value">
                    <h3>{{ valueMoneyCurrent | number: "1.0-0" }}</h3>
                    <span>{{ currentDate | date: 'MMMM yyyy' }}</span>
                </div>
                <hr>
                <div class="value">
                    <h3>{{ valueMoneyBudget | number: "1.0-0" }}</h3>
                    <span>Presupuesto</span>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="!rotateTable" class="card main">
        <div class="summaryChart">
            <canvas #summaryTonsChart></canvas>
        </div>
        <div class="info">
            <div class="title">
                <div class="icon icon-ton">
                    <i class="fa-duotone fa-truck" style="--fa-primary-color: #ffffff; --fa-secondary-color: #ffffff;"></i>
                </div>
                <h3>Toneladas</h3>
            </div>
            <div class="data">
                <div class="value">
                    <h3>{{ valueTonsCurrent | number: "1.0-0" }}</h3>
                    <span>{{ currentDate.getTime() | date: 'MMMM yyyy' }}</span>
                </div>
                <hr>
                <div class="value">
                    <h3>{{ valueTonsBudget | number: "1.0-0" }}</h3>
                    <span>Presupuesto</span>
                </div>
            </div>
    </div>
    </div>
    <div class="card table" [ngClass]="{'table-rotate': rotateTable}">

        <section>
            <!-- <button (click)="rotate()">Rotate</button> -->
            <div class="title">
                <h3 style="margin: 0; justify-self: center;">Mes Actual Nacional</h3>
                <div ngbDropdown container="body" class="d-inline-block dropdown">
                    <div class="actionGroup">
                        <button type="button" class="btn btn-outline-primary" id="dropdownForm1" ngbDropdownToggle>
                            Columnas
                        </button>
                        <div class="filters" (mouseenter)="showFiltersBoxPreview()" (mouseleave)="hideFiltersBoxPreview()">
                            <button type="button" class="btn btn-outline-primary" (click)="openFilters()">
                                Filtrar
                            </button>
                            <div class="box" *ngIf="showFilters">
                                <div class="categFlt" *ngIf="filters?.Filtro?.Canal?.length">
                                    <div class="title">Canal</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Canal">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.Subcanal?.length">
                                    <div class="title">Subcanal</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Subcanal">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.Linea?.length">
                                    <div class="title">Línea</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Linea">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.Segmento?.length">
                                    <div class="title">Segmento</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Segmento">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.Vendedor?.length">
                                    <div class="title">Vendedor</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Vendedor">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.Cliente?.length">
                                    <div class="title">Cliente</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Cliente">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.Producto?.length">
                                    <div class="title">Producto</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Producto">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.Marca?.length">
                                    <div class="title">Marca</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.Marca">{{ filter }}</span>
                                    </div>
                                </div>
                                <div class="categFlt" *ngIf="filters?.Filtro?.UEN?.length">
                                    <div class="title">UEN</div>
                                    <div class="categContent">
                                        <span *ngFor="let filter of filters?.Filtro?.UEN">{{ filter }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-primary" (click)="removeFilter()">
                            Limpiar
                        </button>
                        <!-- <button (click)="setFilterOpen(true)">Filtrar datos</button> -->
                    </div>
                    <div ngbDropdownMenu aria-labelledby="dropdownForm1">
                        <div class="d-flex gap-5 px-3 py-2">
                            <div class="d-flex flex-column">
                                <label class="form-check-label"><input [(ngModel)]="showColumns.valor" type="checkbox" class="form-check-input"/>&nbsp;Valor</label><div class="dropdown-divider"></div>
                                <label class="form-check-label"><input [(ngModel)]="showColumns.tonelada" type="checkbox" class="form-check-input"/>&nbsp;Tonelada</label><div class="dropdown-divider"></div>
                                <label class="form-check-label"><input [(ngModel)]="showColumns.precTon" type="checkbox" class="form-check-input"/>&nbsp;Precio/Tonelada</label><div class="dropdown-divider"></div>
                                <label class="form-check-label"><input [(ngModel)]="showColumns.plan" type="checkbox" class="form-check-input"/>&nbsp;Plan Desarrollo</label><div class="dropdown-divider"></div>
                                <label class="form-check-label"><input [(ngModel)]="showColumns.pedPend" type="checkbox" class="form-check-input"/>&nbsp;Pedidos Pendientes</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <section>
                <div class="buttonGroup">
                    <button (click)="setCurrent('Canal')" [ngClass]="{'current': currentActive === 'Canal'}">Canal <i *ngIf="loading.Canal" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('Subcanal')" [ngClass]="{'current': currentActive === 'Subcanal'}">Subcanal <i *ngIf="loading.Subcanal" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('Linea')" [ngClass]="{'current': currentActive === 'Linea'}">Línea <i *ngIf="loading.Linea" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('Segmento')" [ngClass]="{'current': currentActive === 'Segmento'}">Segmento <i *ngIf="loading.Segmento" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('Vendedor')" [ngClass]="{'current': currentActive === 'Vendedor'}">Vendedor <i *ngIf="loading.Vendedor" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('Cliente')" [ngClass]="{'current': currentActive === 'Cliente'}">Cliente <i *ngIf="loading.Cliente" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('Producto')" [ngClass]="{'current': currentActive === 'Producto'}">Producto <i *ngIf="loading.Producto" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('Marca')" [ngClass]="{'current': currentActive === 'Marca'}">Marca <i *ngIf="loading.Marca" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                    <button (click)="setCurrent('UEN')" [ngClass]="{'current': currentActive === 'UEN'}">UEN <i *ngIf="loading.UEN" class="fa-duotone fa-spinner-third fa-spin" style="--fa-primary-color: #38bdff; --fa-secondary-color: #38bdff; --fa-secondary-opacity: 0.2;"></i></button>
                </div>
                <div class="content">
                    <table>
                        <thead>
                            <tr>
                                <th class="rb">Agrupación</th>
                                <th *ngIf="showColumns.valor" style="text-align: end;">ValorMes</th>
                                <th *ngIf="showColumns.valor" style="text-align: end;">ValorPpto</th>
                                <th class="rb" *ngIf="showColumns.valor" style="text-align: end;">Cumpl</th>
                                <th *ngIf="showColumns.tonelada" style="text-align: end;">TonMes</th>
                                <th *ngIf="showColumns.tonelada" style="text-align: end;">TonMesPpto</th>
                                <th class="rb" *ngIf="showColumns.tonelada" style="text-align: end;">Cumpl</th>
                                <th *ngIf="showColumns.precTon" style="text-align: end;">PrecTon</th>
                                <th class="rb" *ngIf="showColumns.precTon" style="text-align: end;">PrecTonPpto</th>
                                <th *ngIf="showColumns.plan" style="text-align: end;">PlanDUni</th>
                                <th class="rb" *ngIf="showColumns.plan" style="text-align: end;">PlanDValor</th>
                                <th *ngIf="showColumns.pedPend" style="text-align: end;">ValorPedPend</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let record of records">
                                <td class="rb" *ngIf="currentActive === 'Cliente'" noWrap><a style="color: #1199F4" title="Dashboard" target="_blank" [href]="linkToDashboard(record.Agrupacion.split(' ')[0])"><i class="fa-duotone fa-chart-simple"></i></a> {{ record.Agrupacion }}</td>
                                <td class="rb" *ngIf="currentActive !== 'Cliente'" noWrap>{{ record.Agrupacion }}</td>
                                <td *ngIf="showColumns.valor" style="text-align: end;">{{ record.ValorMes | number: "1.1-2" }}</td>
                                <td *ngIf="showColumns.valor" style="text-align: end;">{{ record.ValorPpto | number: "1.1-2" }}</td>
                                <td class="rb" *ngIf="showColumns.valor" style="text-align: end;">{{ record.ValorMes / record.ValorPpto | percent: "1.0-0" }}</td>
                                <td *ngIf="showColumns.tonelada" style="text-align: end;">{{ record.TonMes | number: "1.1-2" }}</td>
                                <td *ngIf="showColumns.tonelada" style="text-align: end;">{{ record.TonMesPpto | number: "1.1-2" }}</td>
                                <td class="rb" *ngIf="showColumns.tonelada" style="text-align: end;">{{ record.TonMes / record.TonMesPpto | percent: "1.0-0" }}</td>
                                <td *ngIf="showColumns.precTon" style="text-align: end;">{{ record.ValorMes / record.TonMes | number: "1.1-2" }}</td>
                                <td class="rb" *ngIf="showColumns.precTon" style="text-align: end;">{{ record.ValorPpto / record.TonMesPpto | number: "1.1-2" }}</td>
                                <td *ngIf="showColumns.plan" style="text-align: end;">{{ record.PlanDUni | number: "1.1-2" }}</td>
                                <td class="rb" *ngIf="showColumns.plan" style="text-align: end;">{{ record.PlanDValor | number: "1.1-2" }}</td>
                                <td *ngIf="showColumns.pedPend" style="text-align: end;">{{ record.ValorPedPend | number: "1.1-2" }}</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td class="rb">Totales</td>
                                <td *ngIf="showColumns.valor" style="text-align: end;">{{ totals.ValorMes | number: "1.1-2"}}</td>
                                <td *ngIf="showColumns.valor" style="text-align: end;">{{ totals.ValorPpto | number: "1.1-2"}}</td>
                                <td class="rb" *ngIf="showColumns.valor" style="text-align: end;">{{ totals.ValorMes / totals.ValorPpto | percent: "1.0-0" }}</td>
                                <td *ngIf="showColumns.tonelada" style="text-align: end;">{{ totals.TonMes | number: "1.1-2"}}</td>
                                <td *ngIf="showColumns.tonelada" style="text-align: end;">{{ totals.TonMesPpto | number: "1.1-2"}}</td>
                                <td class="rb" *ngIf="showColumns.tonelada" style="text-align: end;">{{ totals.TonMes / totals.TonMesPpto | percent: "1.0-0" }}</td>
                                <td *ngIf="showColumns.precTon" style="text-align: end;">{{ totals.ValorMes / totals.TonMes | number: "1.1-2" }}</td>
                                <td class="rb" *ngIf="showColumns.precTon" style="text-align: end;">{{ totals.ValorPpto / totals.TonMesPpto | number: "1.1-2" }}</td>
                                <td *ngIf="showColumns.plan" style="text-align: end;">{{ totals.PlanDUni | number: "1.1-2"}}</td>
                                <td class="rb" *ngIf="showColumns.plan" style="text-align: end;">{{ totals.PlanDValor | number: "1.1-2"}}</td>
                                <td *ngIf="showColumns.pedPend" style="text-align: end;">{{ totals.ValorPedPend | number: "1.1-2"}}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </section>
        </section>
    </div>
</div>

<filter-box></filter-box>